"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[2145],{28453(e,s,n){n.d(s,{R:()=>o,x:()=>t});var l=n(96540);const r={},i=l.createContext(r);function o(e){const s=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),l.createElement(i.Provider,{value:s},e.children)}},60164(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"vkl/kb-layer/class/for_user_role_sql","title":"\u2699\ufe0f for_user_role_sql","description":"Definition","source":"@site/docs/vkl/kb-layer/class/for_user_role_sql.md","sourceDirName":"vkl/kb-layer/class","slug":"/vkl/kb-layer/class/for_user_role_sql","permalink":"/vkl/kb-layer/class/for_user_role_sql","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"\u2699\ufe0f for_user_role_sql","sidebar_position":3},"sidebar":"vkl","previous":{"title":"\u2699\ufe0f description_sql","permalink":"/vkl/kb-layer/class/description_sql"},"next":{"title":"\u2699\ufe0f creation_date","permalink":"/vkl/kb-layer/class/creation_date"}}');var r=n(74848),i=n(28453);const o={title:"\u2699\ufe0f for_user_role_sql",sidebar_position:3},t=void 0,a={},c=[{value:"Definition",id:"definition",level:2},{value:"Special Value: <em>ALLOW_ALL</em>",id:"special-value-allow_all",level:3},{value:"Examples",id:"examples",level:3},{value:"Example 1: Simple Role Assignment",id:"example-1-simple-role-assignment",level:4},{value:"Example 2: Conditional Role Assignment",id:"example-2-conditional-role-assignment",level:4},{value:"Example 3: Multiple Role Columns",id:"example-3-multiple-role-columns",level:4},{value:"Usage with entities_custom_sql",id:"usage-with-entities_custom_sql",level:3}];function d(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"definition",children:"Definition"}),"\n",(0,r.jsxs)(s.p,{children:["The property ",(0,r.jsx)(s.code,{children:"for_user_role_sql"})," specifies how user roles are assigned to entities during syncing, by setting ",(0,r.jsx)(s.code,{children:"for_user_role"})," for the entities. This enables entity-level role-based access control, allowing you to restrict which users can see specific entities based on their assigned roles."]}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsxs)(s.p,{children:["If the SQL returns ",(0,r.jsx)(s.code,{children:"NULL"})," or an empty string, no role is assigned to that entity. If ",(0,r.jsx)(s.code,{children:"for_user_role_sql"})," is defined but no roles are assigned to an entity, ",(0,r.jsx)(s.strong,{children:"the entity will not be created"}),", thus no user would will access to it."]})}),"\n",(0,r.jsxs)(s.h3,{id:"special-value-allow_all",children:["Special Value: ",(0,r.jsx)(s.em,{children:"ALLOW_ALL"})]}),"\n",(0,r.jsxs)(s.p,{children:["The special value ",(0,r.jsx)(s.code,{children:"_ALLOW_ALL_"})," can be used to make an entity accessible to ",(0,r.jsx)(s.strong,{children:"all users"})," without any role restriction. When the SQL returns ",(0,r.jsx)(s.code,{children:"_ALLOW_ALL_"}),", no ",(0,r.jsx)(s.code,{children:"for_user_role"})," is set on the entity, and any roles returned by other ",(0,r.jsx)(s.code,{children:"for_user_role_sql"})," for that entity are also ignored."]}),"\n",(0,r.jsx)(s.p,{children:"This is useful when you want some entities to be public while others are restricted."}),"\n",(0,r.jsx)(s.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.h4,{id:"example-1-simple-role-assignment",children:"Example 1: Simple Role Assignment"}),"\n",(0,r.jsxs)(s.p,{children:["This example shows a basic ",(0,r.jsx)(s.code,{children:"for_user_role_sql"})," for a ",(0,r.jsx)(s.code,{children:"Customer"})," class, where access is restricted based on the customer's region:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:'kb {\n    class Customer {\n        name.en: "Customer"\n        from_table: customer\n        // e.g. 00042\n        sql: "${customer.id}"\n        // e.g. Arthur Dent\n        name_sql.en: "${customer.name}"\n        // Restrict access based on region\n        for_user_role_sql: "${customer.region_role}"\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["The entities will look like this (assuming ",(0,r.jsx)(s.code,{children:"region_role"}),' contains values like "EMEA_Sales"):']}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:'kb.Customer {\n    entity 00042_Arthur_Dent_1234 {\n        name.en: "Arthur Dent"\n\n        for_user_role: "EMEA_Sales"\n\n        id: "00042"\n    }\n    ...\n}\n'})}),"\n",(0,r.jsx)(s.p,{children:'With this configuration, only users with the "EMEA_Sales" role will be able to see and query this entity.'}),"\n",(0,r.jsx)(s.h4,{id:"example-2-conditional-role-assignment",children:"Example 2: Conditional Role Assignment"}),"\n",(0,r.jsx)(s.p,{children:"This example uses a SQL CASE expression to conditionally assign roles based on data values:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:'kb {\n    class Order {\n        name.en: "Order"\n        from_table: orders\n        sql: "${orders.id}"\n        name_sql.en: "\'Order #\' || ${orders.id}"\n        // Assign role based on order value\n        for_user_role_sql: """\n            CASE\n                WHEN ${orders.total_amount} > 10000 THEN \'HighValueSales\'\n                ELSE \'StandardSales\'\n            END\n        """\n    }\n}\n'})}),"\n",(0,r.jsx)(s.h4,{id:"example-3-multiple-role-columns",children:"Example 3: Multiple Role Columns"}),"\n",(0,r.jsxs)(s.p,{children:["You can specify multiple ",(0,r.jsx)(s.code,{children:"for_user_role_sql"})," properties to assign roles from different columns, allowing users with either role to see the entity:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:'kb {\n    class Customer {\n        name.en: "Customer"\n        from_table: customer\n        sql: "${customer.id}"\n        name_sql.en: "${customer.name}"\n        // Assign multiple roles from different columns\n        for_user_role_sql: [\n            "${customer.region_role}",\n            "${customer.department_role}"\n        ]\n    }\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"usage-with-entities_custom_sql",children:"Usage with entities_custom_sql"}),"\n",(0,r.jsxs)(s.p,{children:["When using ",(0,r.jsx)(s.code,{children:"entities_custom_sql"}),", you can include ",(0,r.jsx)(s.code,{children:"FOR_USER_ROLE"})," columns to achieve the same effect:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:'kb {\n    class Customer {\n        name.en: "Customer"\n        tag: DB_CustomSQLSemanticLink\n        sql: "${customer.id}"\n        from_table: customer\n\n        entities_custom_sql: """\n            SELECT\n                c.id AS ID,\n                c.name AS LABEL_EN_MAIN,\n                c.region_role AS FOR_USER_ROLE\n            FROM\n                customer c\n        """\n    }\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Multiple role columns can be specified as ",(0,r.jsx)(s.code,{children:"FOR_USER_ROLE"}),", ",(0,r.jsx)(s.code,{children:"FOR_USER_ROLE_1"}),", ",(0,r.jsx)(s.code,{children:"FOR_USER_ROLE_2"}),", etc.\nFor more details and best practices about defining classes and entities using custom SQL, see ",(0,r.jsx)(s.a,{href:"/vkl/kb-layer/class/sql#advanced-class-with-custom-entities-defined-by-a-sql",children:"Class with Custom Entities defined by a SQL"}),"."]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);