"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[9354],{6269(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"vkl/kb-layer/measure/measure","title":"measure","description":"Definition","source":"@site/docs/vkl/kb-layer/measure/measure.md","sourceDirName":"vkl/kb-layer/measure","slug":"/vkl/kb-layer/measure/","permalink":"/vkl/kb-layer/measure/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"measure"},"sidebar":"vkl","previous":{"title":"onto.CalendarTable","permalink":"/vkl/kb-layer/attribute/extends/calendar-table"},"next":{"title":"Rule","permalink":"/vkl/kb-layer/rule/"}}');var r=s(74848),i=s(28453);const a={title:"measure"},o=void 0,l={},d=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Examples",id:"examples",level:2},{value:"Basic Measures",id:"basic-measures",level:3},{value:"Measures with Filters",id:"measures-with-filters",level:3},{value:"Boolean filters",id:"boolean-filters",level:4},{value:"Entity filters",id:"entity-filters",level:4},{value:"Numeric filters",id:"numeric-filters",level:4},{value:"Measures using other classes",id:"measures-using-other-classes",level:3},{value:"Compositional Measures",id:"compositional-measures",level:3},{value:"Ratio Measures",id:"ratio-measures",level:3},{value:"Net Promoter Score (NPS)",id:"net-promoter-score-nps",level:4},{value:"Measures with Multiple Arguments",id:"measures-with-multiple-arguments",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"definition",children:"Definition"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"measure"})," is a computed numeric aggregation, which you would want to refer to in questions directly or in other measure definitions."]}),"\n",(0,r.jsx)("iframe",{width:"800",height:"500",src:"https://www.youtube.com/embed/gPRsWEJFmQM?si=3Ro-w9S_m6BPxFzk",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"measure"})," is usually defined inside a top-level class (e.g. Order) and has the following properties:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",metastring:'title="knowledge-base/classes/Order/class.vkl"',children:'kb {\n\n    class Order {\n        ...\n\n        measure Revenue {\n\n            /** The name of the measure so you can refer to it in questions.\n             *\tIf this measure is just an intermediate definition, which should not be used in questions, use display_name instead. */ \n            name.en: "Revenue"\n\n            /** The return type of the measure. Currently, it can be either a number (or sometimes more specifically an integer). */\n            return: number\n\n            /** The definition of the measure. This is written in VQL (Veezoo Query Language), which is our optimized syntax to define measures. */\n            definition: """\n                sum(this.Order_Amount)\n            """\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Let's go over some examples to understand how to use measures in Veezoo."}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.h3,{id:"basic-measures",children:"Basic Measures"}),"\n",(0,r.jsx)(n.p,{children:"First of all, in Veezoo, unlike in other BI tools, you don't need to define a measure to be able to ask questions involving aggregations.\nFor instance, you don't need to have an \"average order amount\" explicitly defined to be able to ask about it, since Veezoo knows what average means. This also applies to totals (e.g. total order amount), counts (e.g. number of users) and even percentages (e.g. percentage of First Class orders)."}),"\n",(0,r.jsx)(n.p,{children:"However, sometimes you will still want to define explicitly the measure. The main case we see in Veezoo is when the name of the measure doesn't capture completely the logic behind it.\nYou may also want to add a description to it and display it more prominently in Autocomplete to guide users better."}),"\n",(0,r.jsx)(n.p,{children:"Let's start with simple examples:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n\n        ...\n\n        /** A numeric value defined in the database. */\n        number Order_Amount {\n            ...\n        }\n\n        measure Revenue {\n            name.en: "Revenue"\n            return: number\n\n            definition: """\n                sum(this.Order_Amount)\n            """            \n        }\n\n        measure Avg_Order_Value {\n            name.en: "Average Order Value"\n            return: number\n\n            definition: """\n                average(this.Order_Amount)\n            """ \n        }\n\n        measure Number_of_Orders { \n            name.en: "Number of Orders"\n            return: integer\n\n            definition: """\n                count(this)\n            """\n        } \n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Measures are defined in VQL. A detailed explanation of this language can be found ",(0,r.jsx)(n.a,{href:"/vkl/kb-layer/vql/",children:"here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The first thing you notice is the usage of the word ",(0,r.jsx)(n.code,{children:"this"}),". It refers to the top-level class this measure is based on, in this case: ",(0,r.jsx)(n.code,{children:"kb.Order"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"measures-with-filters",children:"Measures with Filters"}),"\n",(0,r.jsx)(n.p,{children:'As mentioned before, a common case for measures is when there is a non-obvious logic to it, meaning it is not in the name of the measure itself. "Revenue in Germany" for instance does not need to be defined as a measure if Germany is just a country in the database. But maybe "Revenue" itself would require a flag \'is_cancelled\' to be false or another filter to be set.'}),"\n",(0,r.jsx)(n.h4,{id:"boolean-filters",children:"Boolean filters"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n\n        number Order_Amount { ... }\n\n        boolean is_Cancelled { ... }\n\n        measure Revenue {\n            name.en: "Revenue"\n            \n            description.en: "Revenue only includes orders that were not cancelled"\n\n            return: number\n\n            definition: """\n                this.is_Cancelled = false\n\n                sum(this.Order_Amount)\n            """\n        }\n\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, if the boolean filter needs to be true, we would have had ",(0,r.jsx)(n.code,{children:"this.is_Active = true"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"entity-filters",children:"Entity filters"}),"\n",(0,r.jsx)(n.p,{children:"What if we didn't have a boolean flag, but rather a specific entity (e.g. 'Active') that we needed to filter for?"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n\n        number Order_Amount { ... }\n\n        /** Possible Status: Cancelled, Active, On_Hold */\n        class Status { ... }\n\n        measure Revenue {\n            name.en: "Revenue"\n            \n            description.en: "Revenue only includes orders that were active."\n\n            return: number\n\n            definition: """\n                this.Status = kb.Order.Status.Active    # alternatively, you can also use a string directly, e.g. "Active"\n\n                sum(this.Order_Amount)\n            """\n        }\n\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["What if you need to filter out an entity, e.g. not cancelled? Let's see just how the ",(0,r.jsx)(n.code,{children:"definition"})," changes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n    this.Status != kb.Order.Status.Cancelled\n\n    sum(this.Order_Amount)\n"""\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Finally, maybe there are multiple statuses that you need to consider. For this case, we use a ",(0,r.jsx)(n.code,{children:"union"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n    this.Status = union(kb.Order.Status.Active, kb.Order.Status.On_Hold)\n\n    sum(this.Order_Amount)\n"""\n'})}),"\n",(0,r.jsx)(n.h4,{id:"numeric-filters",children:"Numeric filters"}),"\n",(0,r.jsx)(n.p,{children:"Let's say instead that to calculate Revenue, we should ignore all orders with negative Order_Amount."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n    this.Order_Amount >= 0\n\n    sum(this.Order_Amount)\n"""\n'})}),"\n",(0,r.jsxs)(n.p,{children:["For numeric filters, we support: ",(0,r.jsx)(n.code,{children:"<"}),", ",(0,r.jsx)(n.code,{children:"<="}),", ",(0,r.jsx)(n.code,{children:">"})," and ",(0,r.jsx)(n.code,{children:">="}),". We also support numeric operators like ",(0,r.jsx)(n.code,{children:"*"}),", ",(0,r.jsx)(n.code,{children:"+"}),", ",(0,r.jsx)(n.code,{children:"/"})," and ",(0,r.jsx)(n.code,{children:"-"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"measures-using-other-classes",children:"Measures using other classes"}),"\n",(0,r.jsx)(n.p,{children:"What if for Revenue we actually need to filter out customers that are inactive (according to a separate class and table)?"}),"\n",(0,r.jsx)(n.p,{children:"This is how the measure definition would change:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n\n        relationship from_Customer { ... }\n        \n        measure Revenue {\n            name.en: "Revenue"\n            \n            description.en: "Revenue only includes orders from active customers."\n\n            return: number\n\n            definition: """\n                var c: kb.Customer     # think of this like the following SQL: FROM customers c\n\n                this.from_Customer = c\n                c.is_Active = true\n\n                sum(this.Order_Amount)\n            """\n        }\n\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"This can be made shorter:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n    this.from_Customer.is_Active = true\n\n    sum(this.Order_Amount)\n"""\n'})}),"\n",(0,r.jsx)(n.p,{children:"Now, let's go a bit wild. What if Revenue should be defined as total order amount only from customers that had at least 2 orders at any point in time."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n\n    var c: kb.Customer\n\n    # c is this order\'s customer\n    this.from_Customer = c\n\n    var o: kb.Order  \t\t# these are separate orders\n    o.from_Customer = c  \t# from the same customer\n    \n    # let\'s count these orders here for each customer\n    # the parenthesis are required\n    var number_of_orders = count(o) by (c)\n    \n    # only those customers with at least 2 orders\n    number_of_orders >= 2\n\n    sum(this.Order_Amount)\n"""\n'})}),"\n",(0,r.jsxs)(n.p,{children:['It is important to notice here that if you ask "Revenue this month", Veezoo will compute the revenue from orders this month with customers that at any point in time did at least 2 orders, not restricted to this month. This happens because we introduce a new order ',(0,r.jsx)(n.code,{children:"var o: kb.Order"})," that does not have any of the filters from ",(0,r.jsx)(n.code,{children:"this"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"compositional-measures",children:"Compositional Measures"}),"\n",(0,r.jsx)(n.p,{children:"Sometimes we will want to reuse existing measures in new definitions, because we depend on them or because we want to keep the code more readable."}),"\n",(0,r.jsx)(n.p,{children:"Let's say we want to define gross profit margin in %. We will start by defining it in one measure."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n\n        number Gross_Profit_Margin { ... }\n\n        number Sale_Price { ... }\n        \n        measure Gross_Profit_Margin_Percentage {\n            name.en: "Gross Profit Margin (in %)"\n\n            return: number\n\n            # So we can see in %\n            unit: onto.Percentage\n\n            definition: """\n                var total_gpm = sum(this.Gross_Profit_Margin)\n                var total_sale = sum(this.Sale_Price)\n\n                (total_gpm / total_sale) * 100\t\t# Multiply by 100 so we get a percentage\n            """\n        }\n\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you could also define it shorter as ",(0,r.jsx)(n.code,{children:"(sum(this.Gross_Profit_Margin) / sum(this.Sale_Price)) * 100"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Great. But this assumes that gross profit margin and sale price just require a sum. As we have seen before, these could be arbitrarily complex."}),"\n",(0,r.jsxs)(n.p,{children:["So let's say we have two measures ",(0,r.jsx)(n.code,{children:"Total_Gross_Profit_Margin"})," and ",(0,r.jsx)(n.code,{children:"Total_Sale_Price"}),". And now we will define it again using these measures."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n\n        measure Total_Gross_Profit_Margin { ... }\n\n        measure Total_Sale_Price { ... }\n        \n        measure Gross_Profit_Margin_Percentage {\n            name.en: "Gross Profit Margin (in %)"\n\n            return: number\n\n            # So we can see in %\n            unit: onto.Percentage\n\n            definition: """\n                var total_gpm = kb.Order.Total_Gross_Profit_Margin(this)\n                var total_sale = kb.Order.Total_Sale_Price(this)\n\n                (total_gpm / total_sale) * 100\t\t# Multiply by 100 so we get a percentage\n            """\n        }\n\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The syntax to refer to a measure is similar to an aggregation function (e.g. sum, count), meaning it takes an argument. The argument is usually ",(0,r.jsx)(n.code,{children:"this"}),", which is the top-level class with all the filters from the question."]}),"\n",(0,r.jsx)(n.h3,{id:"ratio-measures",children:"Ratio Measures"}),"\n",(0,r.jsxs)(n.p,{children:["Consider the following situation: You have a class ",(0,r.jsx)(n.code,{children:"Newsletter"})," which has the Booleans ",(0,r.jsx)(n.code,{children:"opened"})," and ",(0,r.jsx)(n.code,{children:"clicked"}),". You now want to define the CTR (click through-rate), computed as the number of newsletters which are clicked, divided by the number of newsletters which are opened. With a simple measure one might (wrongly) try the following:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'definition: """\n\tvar openedNewsletters = this\n\tvar clickedNewsletters = this\n\n\topenedNewsletters.opened = true\n\tclickedNewsletters.clicked = true\n\n\tcount(clickedNewsletters) / count(openedNewsletters)\n"""\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Unfortunately this doesn't work. The issue here is that ",(0,r.jsx)(n.code,{children:"this"})," refers to one specific instance of the class ",(0,r.jsx)(n.code,{children:"Newsletter"}),", meaning that ",(0,r.jsx)(n.code,{children:"openedNewsletter"})," and ",(0,r.jsx)(n.code,{children:"clickedNewsletter"})," refer to the same thing and so when the filters are applied, they are applied to both. This measure would always return 1."]}),"\n",(0,r.jsx)(n.p,{children:"The solution is to use define the ratio measure through other measures:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'measure CTR {\n    name: "click through rate"\n    \n\tdefinition: """\n\t\tkb.Newsletter.clickedLetters(this) / kb.Newsletter.openedLetters(this)\n\t"""\n    return: number\n}\n\nmeasure openedLetters {\n    name: "opened Letters"\n\thidden: true\n    \n\tdefinition: """\n\t\tthis.opened = true\n\n\t\tcount(this)\n\t"""\n    return: number\n}\n\nmeasure clickedLetters {\n    name: "clicked Letters"\n\thidden: true\n    \n\tdefinition: """\n\t\tthis.clicked = true\n\n\t\tcount(this)\n\t"""\n    return: number\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Veezoo makes sure in this case that the calculation of each measure does not affect the other."}),"\n",(0,r.jsx)(n.h4,{id:"net-promoter-score-nps",children:"Net Promoter Score (NPS)"}),"\n",(0,r.jsx)(n.p,{children:"A common example of a composite measure is the Net Promoter Score (NPS). The NPS is a market research metric based on a single survey question that asks respondents to rate the likelihood of recommending a company, product, or service to a friend or colleague. Respondents are asked to grade what is being surveyed on a scale from 1 to 10, indicating how much they like it. Users are then grouped into three categories: people answering 1\u20136 are considered detractors, 7\u20138 passives, and 9\u201310 promoters."}),"\n",(0,r.jsx)(n.p,{children:"The NPS is then calculated as the percentage of promoters minus the number of detractors."}),"\n",(0,r.jsx)(n.p,{children:"Here is how this would be implemented in Veezoo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n    class Feedback {\n        name: "Feedback"\n        sql: "${Feedback.Id}"\n        \n        number Value {\n            name: "Value"\n            \n            sql: "${Feedback.Value}"\n        }\n\n        measure PercentageDetractors {\n            name: "Percentage of Detractors"\n            \n            definition: \n             """var detractors = proportion(this) { \n                  this.Value <= 6\n                }\n                \n                detractors"""\n            return: number\n            unit: onto.Percentage\n        }\n\n        measure PercentagePromoters {\n            name: "Percentage of Promoters"\n            \n            definition: \n             """var promoters = proportion(this) { \n                  this.Value >= 9\n                }\n                \n                promoters"""\n            return: number\n            unit: onto.Percentage\n        }\n        \n        measure NPS {\n            name: "NPS"\n\n            definition: "kb.Feedback.PercentagePromoters(this) - kb.Feedback.PercentageDetractors(this)"\n            return: number\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"measures-with-multiple-arguments",children:"Measures with Multiple Arguments"}),"\n",(0,r.jsxs)(n.p,{children:["As previously discussed, measures usually take as its argument the class that it is implemented in (which is then referred to as it ",(0,r.jsx)(n.code,{children:"this"}),"). Veezoo supports a more general case of measures as well."]}),"\n",(0,r.jsxs)(n.p,{children:["By using the syntax ",(0,r.jsx)(n.code,{children:"arguments: [kb.Order, kb.Customer, ...]"}),", you can define any number of arguments for the measure. These arguments are then accessible via the keywords ",(0,r.jsx)(n.code,{children:"arg1"}),", ",(0,r.jsx)(n.code,{children:"arg2"}),", etc., in the order they appear in the array."]}),"\n",(0,r.jsxs)(n.p,{children:["This approach is particularly useful for performing calculations involving multiple, unrelated classes. For example, consider calculating the ",(0,r.jsx)(n.code,{children:"Loss Ratio"})," for an insurance company. The ",(0,r.jsx)(n.code,{children:"Loss Ratio"})," could be defined as the total amount paid on ",(0,r.jsx)(n.code,{children:"Claims"})," divided by the total premiums earned on ",(0,r.jsx)(n.code,{children:"Policies"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'measure Loss_Ratio {\n    name.en: "Loss Ratio"\n    \n    arguments: [ kb.Claim, kb.Policy ]\n    definition: """\n        sum(arg1.claimAmount) / sum(arg2.premiumAmount)\n    """\n    return: number\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In this scenario, it is necessary to use two arguments. If there were a relationship between ",(0,r.jsx)(n.code,{children:"Claim"})," and ",(0,r.jsx)(n.code,{children:"Policy"}),", one might be tempted to define a single-argument measure within ",(0,r.jsx)(n.code,{children:"kb.Claim"})," as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'measure Loss_Ratio {\n    name.en: "Loss Ratio"\n\n    definition: """\n        var policy = this.Policy\n        sum(this.claimAmount) / sum(policy.premiumAmount)\n    """\n    return: number\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["However, this approach would NOT work because it would filter out all ",(0,r.jsx)(n.code,{children:"Policies"})," that do not have an associated ",(0,r.jsx)(n.code,{children:"Claim"}),". By using multiple arguments, you ensure that all relevant data is included in the calculation."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>a,x:()=>o});var t=s(96540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);