"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[6477],{10867(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"vkl/db-layer/virtual-table","title":"virtual_table","description":"Definition","source":"@site/docs/vkl/db-layer/virtual-table.md","sourceDirName":"vkl/db-layer","slug":"/vkl/db-layer/virtual-table","permalink":"/vkl/db-layer/virtual-table","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"virtual_table","sidebar_position":1},"sidebar":"vkl","previous":{"title":"\u2699\ufe0f html","permalink":"/vkl/kb-layer/general/html"},"next":{"title":"Discovery","permalink":"/vkl/discovery/"}}');var r=t(74848),a=t(28453),o=t(86025);const l={title:"virtual_table",sidebar_position:1},s=void 0,d={},c=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Example: Changing a Table to a Virtual Table",id:"example-changing-a-table-to-a-virtual-table",level:3},{value:"Example: Joining tables",id:"example-joining-tables",level:3}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"definition",children:"Definition"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"virtual_table"})," is a powerful tool to define views based on existing tables by modifying, aggregating, or filtering the data in some way, all within the Veezoo Knowledge Graph."]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"virtual_table"})," allows you to define a new view/table using SQL that manipulates or extends the original data. You can then reference this virtual table like any other table when creating classes or defining columns."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": Virtual tables should mostly be used for prototyping more complex logic. As a best practice, once the definition is finalized, it should be moved to dbt or a similar tool for long-term maintainability and better performance."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-changing-a-table-to-a-virtual-table",children:"Example: Changing a Table to a Virtual Table"}),"\n",(0,r.jsx)(n.p,{children:"Suppose we have a dataset with order data, including the order date and customer ID. We want to create a virtual table that adds a column with the order number (e.g. the first order, second, etc.) for each customer, based on the order date."}),"\n",(0,r.jsx)(n.p,{children:"To do that you will first need to switch the sidebar in Studio to show the file tree instead:"}),"\n",(0,r.jsx)("img",{alt:"Switch to file tree",width:"250",src:(0,o.default)("/img/tutorials/historized-tables/01-open-file-tree.png")}),"\n",(0,r.jsxs)(n.p,{children:["Then open the table definition file for the ",(0,r.jsx)(n.code,{children:"orders"})," table."]}),"\n",(0,r.jsx)("img",{alt:"Switch to file tree",width:"250",src:(0,o.default)("/img/tutorials/historized-tables/02-open-table-file-2.png")}),"\n",(0,r.jsx)(n.p,{children:"We can change an existing table definition:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'db.orders_db.public {\n    table orders {\n        identifier: "orders"      \n        \n        ...\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["...to use ",(0,r.jsx)(n.code,{children:"virtual_table"})," and include a ",(0,r.jsx)(n.code,{children:"virtual_table_sql"})," instead:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'import: [\n    db.postgres.orders_db.public.ORDERS\n]\n\ndb.orders_db.public {\n    virtual_table orders {\n        identifier: "orders"\n\n        virtual_table_sql:\n         """\n            SELECT\n                o.*,\n                ROW_NUMBER() OVER (\n                    PARTITION BY o."customer_id"\n                    ORDER BY o."order_date" ASC\n                ) as "customer_order_number"\n            FROM\n                "orders_db"."public"."orders" o\n         """\n\n        // Define the new column\n        column customer_order_number {\n            identifier: "customer_order_number"\n            primitive_type: "INTEGER"\n        }\n\n        ...\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Now you can reference it in a new integer attribute ",(0,r.jsx)(n.code,{children:"Customer_Order_Number"})," in your ",(0,r.jsx)(n.code,{children:"Order"})," class."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'kb {\n\n    class Order {\n        ...\n        \n        // Reference the new column\n        integer Customer_Order_Number {\n            name.en: "Customer Order Number"\n            sql: "${orders.customer_order_number}"\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-joining-tables",children:"Example: Joining tables"}),"\n",(0,r.jsxs)(n.p,{children:["You are not limited to using the content of a single table; you can join or union several tables into a virtual table. In the following example, we want to include a ",(0,r.jsx)(n.code,{children:"payment_method"})," in our ",(0,r.jsx)(n.code,{children:"transaction"})," table, even though it is stored separately in the database. We can adjust the definition of the ",(0,r.jsx)(n.code,{children:"transaction"})," table in the following fashion:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'db.transaction_db.public{\n    virtual_table transaction {\n        identifier: "transaction"\n        \n        virtual_table_sql:\n        """\n            SELECT \n                t.*,\n                p."payment_method"\n            FROM \n                "transaction_db"."public"."transaction" t\n            JOIN \n                "transaction_db"."public"."payment" p\n            ON \n                t."transaction_id" = p."transaction_id"\n        """\n        \n        column payment_method {\n            identifier: "payment_method"\n            primitive_type: "text"\n        }\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["For another example, check ",(0,r.jsx)(n.a,{href:"/veezoo/tutorials/historized-tables",children:"our tutorial on historized tables"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);