"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[9480],{28453(t,e,n){n.d(e,{R:()=>r,x:()=>l});var i=n(96540);const s={},o=i.createContext(s);function r(t){const e=i.useContext(o);return i.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function l(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:r(t.components),i.createElement(o.Provider,{value:e},t.children)}},80091(t,e,n){n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"vkl/kb-layer/class/default_filter","title":"\u2699\ufe0f default_filter","description":"Definition","source":"@site/docs/vkl/kb-layer/class/default_filter.md","sourceDirName":"vkl/kb-layer/class","slug":"/vkl/kb-layer/class/default_filter","permalink":"/vkl/kb-layer/class/default_filter","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"\u2699\ufe0f default_filter","sidebar_position":7},"sidebar":"vkl","previous":{"title":"\u2699\ufe0f default_order","permalink":"/vkl/kb-layer/class/default_order"},"next":{"title":"\u2699\ufe0f display_with","permalink":"/vkl/kb-layer/class/display_with"}}');var s=n(74848),o=n(28453);const r={title:"\u2699\ufe0f default_filter",sidebar_position:7},l=void 0,a={},c=[{value:"Definition",id:"definition",level:2},{value:"Usage",id:"usage",level:2},{value:"Boolean Filter",id:"boolean-filter",level:3},{value:"Entity Filter",id:"entity-filter",level:3},{value:"Numeric filters",id:"numeric-filters",level:3},{value:"Filters across classes",id:"filters-across-classes",level:3},{value:"Refactoring",id:"refactoring",level:3},{value:"Conditional Default Filters",id:"conditional-default-filters",level:2}];function d(t){const e={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"definition",children:"Definition"}),"\n",(0,s.jsxs)(e.p,{children:["A ",(0,s.jsx)(e.code,{children:"default_filter"})," is a filter expression for a class that is applied by default if no conflicting filter was already explicitly asked for in a question."]}),"\n",(0,s.jsxs)(e.p,{children:['With it you are able to model more accurately the language inside your company. An example is when we have subscriptions in the data, but it contains also cancelled ones. Yet, when people ask about subscriptions, they intuitively expect to see only "active" ones. With ',(0,s.jsx)(e.code,{children:"default_filter"}),', you don\'t need to pass the burden to the user of remembering to ask for "active", while not limiting their experience, if asking for "inactive" subscriptions is also a common use case.']}),"\n",(0,s.jsxs)(e.p,{children:["Whenever you set a ",(0,s.jsx)(e.code,{children:"default_filter"}),", the users will see it clearly in the answer with the possibility to remove it by clicking on it."]}),"\n",(0,s.jsx)("iframe",{width:"800",height:"500",src:"https://www.youtube.com/embed/jIdIdXz9_O4?si=LjsPceT3pj87pDdZ",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),"\n",(0,s.jsx)(e.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(e.h3,{id:"boolean-filter",children:"Boolean Filter"}),"\n",(0,s.jsxs)(e.p,{children:["Let's take the example above. We have a class ",(0,s.jsx)(e.code,{children:"kb.Subscription"})," with a ",(0,s.jsx)(e.code,{children:"boolean is_Active"}),". This is how you would define it, using the VQL (Veezoo Query Language) syntax:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\n\tclass Subscription {\n\n\t\tname.en: "Subscription"\n\n\t\t...\n\n\n\t\tdefault_filter: """\n\t\t\tthis.is_Active = true\n\t\t"""\n\n\t\tboolean is_Active { ... }\n\n\t}\n\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Notice the usage of ",(0,s.jsx)(e.code,{children:"this"}),", which refers to the ",(0,s.jsx)(e.code,{children:"Subscription"})," class."]}),"\n",(0,s.jsx)(e.p,{children:"What if you have two filters? Just create a list of all of them to create multiple independent default filters."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\n\tclass Subscription {\n\n\t\tname.en: "Subscription"\n\n\t\t...\n\n\n        /* Create a list using [...] */\n\t\tdefault_filter: [\n\t\t\t"this.is_Active = true",\n\t\t\t"this.is_Valid = true"\n\t\t]\n\n\t\tboolean is_Active { ... }\n\n\t\tboolean is_Valid { ... }\n\n\t}\n\n}\n'})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"We recommend you keep the default filters simple, and split them up into multiple filters instead of one big filter for the best experience.\nCombining multiple default filters into one filter will make them interact in unexpected ways.\nIf the example above was a single default filter instead of two it would for example not add the active filter if a valid filter is already present."})}),"\n",(0,s.jsx)(e.h3,{id:"entity-filter",children:"Entity Filter"}),"\n",(0,s.jsxs)(e.p,{children:["Now, maybe there is no ",(0,s.jsx)(e.code,{children:"is_Active"})," flag, but rather a ",(0,s.jsx)(e.code,{children:"Status"})," which can be 'Active'."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\n\tclass Subscription {\n\n\t\tname.en: "Subscription"\n\n\t\t...\n\n\t\tdefault_filter: """\n\t\t\tthis.Status = kb.Subscription.Status.Active  # Tip: Let the Editor\'s Autocomplete help you find the right way to refer to the Status Active here\n\t\t"""\n\n\t\t/** This is a class Status with entities like kb.Status.Active. */\n\t\tclass Status { ... }\n\n\t}\n\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:['In this case, if you would ask "how many subscriptions per status", Veezoo is smart enough to know not to apply the ',(0,s.jsx)(e.code,{children:"default_filter"}),"."]}),"\n",(0,s.jsx)(e.p,{children:"For negations, do it like this:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'default_filter: """\n\tthis.Status != kb.Subscription.Status.Cancelled\n"""\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Finally, maybe there are multiple statuses that you need to consider. For this case, we use a ",(0,s.jsx)(e.code,{children:"union"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'default_filter: """\n\tthis.Status = union(kb.Subscription.Status.Active, kb.Subscription.Status.On_Hold)\n"""\n'})}),"\n",(0,s.jsx)(e.h3,{id:"numeric-filters",children:"Numeric filters"}),"\n",(0,s.jsx)(e.p,{children:"Let's say instead that we want to keep only those subscriptions by default with a positive subscription amount."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'default_filter: """\n\tthis.Amount > 0\n"""\n'})}),"\n",(0,s.jsxs)(e.p,{children:["For numeric filters, we support: ",(0,s.jsx)(e.code,{children:"<"}),", ",(0,s.jsx)(e.code,{children:"<="}),", ",(0,s.jsx)(e.code,{children:">"})," and ",(0,s.jsx)(e.code,{children:">="}),". We also support numeric operators like ",(0,s.jsx)(e.code,{children:"*"}),", ",(0,s.jsx)(e.code,{children:"+"}),", ",(0,s.jsx)(e.code,{children:"/"})," and ",(0,s.jsx)(e.code,{children:"-"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"filters-across-classes",children:"Filters across classes"}),"\n",(0,s.jsx)(e.p,{children:"What if we need to filter out subscriptions that have a inactive customer (according to a separate class and table)?"}),"\n",(0,s.jsx)(e.p,{children:"This is how the default filter would change:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\n\tclass Subscription {\n\t\t...\n\n\t\trelationship from_Customer { ... }\n\t\t\n\t\tdefault_filter: """\n\t\t\tvar c: kb.Customer     # think of this like the following SQL: FROM customers c\n\n\t\t\tthis.from_Customer = c\n\t\t\tc.is_Active = true\n\t\t"""\n\t}\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"This can be made shorter:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'default_filter: """\n\tthis.from_Customer.is_Active = true\n"""\n'})}),"\n",(0,s.jsx)(e.p,{children:"Now, let's go a bit wild."}),"\n",(0,s.jsx)(e.p,{children:"Let's say we have subscriptions and actual orders. And subscriptions should by default include only those with customers that had at least 2 orders at any point in time."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'default_filter: """\n\tvar c: kb.Customer\n\n\t# c is this subscription\'s customer\n\tthis.from_Customer = c\n\n\tvar o: kb.Order  \t\t# these are orders from the same customer\n\to.from_Customer = c\n\t\n\t# let\'s count these orders here for each customer\n\tvar number_of_orders = count(o) by c\n\t\n\t# only those customers with at least 2 orders\n\tnumber_of_orders >= 2\n"""\n'})}),"\n",(0,s.jsx)(e.h3,{id:"refactoring",children:"Refactoring"}),"\n",(0,s.jsx)(e.p,{children:"Now this could get unnecessarily complicated and usually you will want to push certain definitions down to the data warehouse as part of your transformation layer (e.g. using dbt), especially if other applications or data consumers would benefit from it. This will allow you to have just a simple boolean flag and then we are back to the first example."}),"\n",(0,s.jsxs)(e.p,{children:["If for whatever reason you don't want to do so, you can also define a ",(0,s.jsx)(e.code,{children:"boolean"})," in Veezoo with the code from your more complicated ",(0,s.jsx)(e.code,{children:"default_filter"}),"."]}),"\n",(0,s.jsx)(e.p,{children:"Let's take it from the last example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\tclass Subscription {\n\n\t\t...\n\n\t\tdefault_filter: "this.is_Active = true"\n\n\t\tboolean is_Active {\n\t\t\tname.en: "Active"\n\n\t\t\tdescription.en:\n\t\t\t\t"A subscription is active if it is from a customer that made at least two orders."\n\n\t\t\tdefinition: """\n\t\t\t\tvar c: kb.Customer\n\n\t\t\t\t# c is this subscription\'s customer\n\t\t\t\tthis.from_Customer = c\n\n\t\t\t\tvar o: kb.Order  \t\t# these are orders from the same customer\n\t\t\t\to.from_Customer = c\n\t\t\t\t\n\t\t\t\t# let\'s count these orders here for each customer\n\t\t\t\tvar number_of_orders = count(o) by c\n\t\t\t\t\n\t\t\t\t# only those customers with at least 2 orders\n\t\t\t\tnumber_of_orders >= 2\n\t\t\t"""\n\t\t}\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Or better, defining it in the ",(0,s.jsx)(e.code,{children:"kb.Customer"})," class."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\n\tclass Customer {\n\n\t\t...\n\n\t\tdefault_filter: "this.is_Active = true"\n\n\t\tboolean is_Active {\n\t\t\tname.en: "Active"\n\n\t\t\tdescription.en: "A customer that made at least two orders is deemed active."\n\n\t\t\tdefinition: """\n\t\t\t\tvar o: kb.Order\n\t\t\t\to.from_Customer = this\n\t\t\t\t\t\t\t\n\t\t\t\tvar number_of_orders = count(o)\n\t\t\t\tnumber_of_orders >= 2\n\t\t\t"""\n\t\t}\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Now, you can define the ",(0,s.jsx)(e.code,{children:"default_filter"})," for ",(0,s.jsx)(e.code,{children:"Subscription"})," as simply:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\tclass Subscription {\n\t\t\t...\n\n\t\t\trelationship from_Customer { ... }\n\t\t\t\n\t\t\tdefault_filter: "this.from_Customer"\n\t}\t\n}\t\n'})}),"\n",(0,s.jsx)(e.p,{children:"This may seem a bit less intuitive at first sight, but it means that the subscription has by default a customer set, which is itself by default active."}),"\n",(0,s.jsx)(e.p,{children:"Ok, now that you know how to do all of this, remember the golden rule: Keep It Simple, Stupid."}),"\n",(0,s.jsx)(e.h2,{id:"conditional-default-filters",children:"Conditional Default Filters"}),"\n",(0,s.jsxs)(e.p,{children:["With a ",(0,s.jsx)(e.code,{children:"condition"})," it is possible to have a ",(0,s.jsx)(e.code,{children:"default_filter"})," which only applies in certain situations. It also enables you to add a ",(0,s.jsx)(e.code,{children:"default_filter"})," attribute on concepts like ",(0,s.jsx)(e.code,{children:"integers"})," or ",(0,s.jsx)(e.code,{children:"measures"})," which normally wouldn't allow to have one directly."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\tclass Subscription {\n\t\t...\n\n\t\tdefault_filter: {\n\t\t\tfilter: "this.is_Active = true"\n\t\t\tcondition: "kb.Subscription.ClickThroughRate(this)"\n\t\t}\n\n\t\tmeasure ClickThroughRate { ... }\n\n\t\tboolean is_Active { ... }\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["The ",(0,s.jsx)(e.code,{children:"condition"})," works similarly to the one found in ",(0,s.jsx)(e.a,{href:"/vkl/kb-layer/rule",children:"rules"}),". It is one or more lines of VQL code, which if present in the question, tell Veezoo to add the filter. In the example above it simply states ",(0,s.jsx)(e.em,{children:"If the ClickThroughRate is present in the question, add the filter that is_Active has to be true"}),"."]}),"\n",(0,s.jsx)(e.p,{children:"As with default filters without a condition, it is possible to have multiple ones with:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\tclass Subscription {\n\t\t...\n\n\t\tdefault_filter: [\n\t\t\t{\n\t\t\t\tfilter: "this.is_Active = true"\n\t\t\t\tcondition: "kb.Subscription.ClickThroughRate(this)"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfilter: "this.is_Trial_Account = false"\n\t\t\t\tcondition: "average(this.SubscriptionFee)"\n\t\t\t}\n\t\t]\n\n\t\tmeasure ClickThroughRate { ... }\n\n\t\tinteger SubscriptionFee { ... }\n\n\t\tboolean is_Active { ... }\n\t}\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Here, in this second filter, Veezoo is told to add a filter excluding trial accounts if the average subscription fee is calculated. Note that the filter would not be added, if asked about subscription fees more generally."}),"\n",(0,s.jsxs)(e.p,{children:["The ",(0,s.jsx)(e.code,{children:"condition"})," can also be negative. With a ",(0,s.jsx)(e.code,{children:"@missing {...}"})," block, a default filter can be added, when a VQL expression does not appear in the question. This is a very common use case."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:'kb {\n\tclass Subscription {\n\t\t...\n\n\t\tdefault_filter: {\n\t\t\tfilter: "this.is_Active = true"\n\t\t\tcondition: "@missing { this.cancellation_Date }"\n\t\t}\n\n\t\tboolean is_Active { ... }\n\n\t\tdate cancellation_Date { ... }\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["In this case here, the filter ",(0,s.jsx)(e.code,{children:"is_Active"})," is always added, except in questions about about the cancellation date, in which case it wouldn't make much sense to talk about active accounts."]})]})}function h(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(d,{...t})}):d(t)}}}]);