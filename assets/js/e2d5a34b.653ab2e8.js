"use strict";(self.webpackChunkveezoo_docs=self.webpackChunkveezoo_docs||[]).push([[2229],{28453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},38414(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"veezoo/authorization/row-level-permission","title":"Row-Level Permission","description":"In Veezoo, we provide a method to achieve row-level authorization using SQL templating with the virtual_table feature. This allows for custom data access restrictions down to the row level based on user-specific values.","source":"@site/docs/veezoo/authorization/row-level-permission.md","sourceDirName":"veezoo/authorization","slug":"/veezoo/authorization/row-level-permission","permalink":"/veezoo/authorization/row-level-permission","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Row-Level Permission","sidebar_position":5},"sidebar":"veezoo","previous":{"title":"Column-Level Permission","permalink":"/veezoo/authorization/column-level-permission"},"next":{"title":"Embedded Analytics with Veezoo","permalink":"/veezoo/embedded/embedded-guide"}}');var t=s(74848),r=s(28453);const o={title:"Row-Level Permission",sidebar_position:5},l=void 0,a={},d=[{value:"SQL Templating",id:"sql-templating",level:2},{value:"Support",id:"support",level:3},{value:"Templating Language",id:"templating-language",level:3},{value:"Pre-Defined Attributes and Variables",id:"pre-defined-attributes-and-variables",level:3},{value:"Row-Level Authorization",id:"row-level-authorization",level:2},{value:"Bypassing Row-Level Security for Technical Users",id:"bypassing-row-level-security-for-technical-users",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["In Veezoo, we provide a method to achieve row-level authorization using SQL templating with the ",(0,t.jsx)(n.code,{children:"virtual_table"})," feature. This allows for custom data access restrictions down to the row level based on user-specific values."]}),"\n",(0,t.jsx)(n.h2,{id:"sql-templating",children:"SQL Templating"}),"\n",(0,t.jsx)(n.p,{children:"SQL templating allows parts of your SQL properties to be adjusted dynamically based on user-specific values. For example, you can use it to compare a user's email with a column in your table."}),"\n",(0,t.jsx)(n.h3,{id:"support",children:"Support"}),"\n",(0,t.jsx)(n.p,{children:"Currently, SQL templating is supported in the following locations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Identifiers of database/schema/table/column"}),"\n",(0,t.jsx)(n.li,{children:"Including database identifier in DB connection"}),"\n",(0,t.jsx)(n.li,{children:"Virtual table SQL"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"templating-language",children:"Templating Language"}),"\n",(0,t.jsxs)(n.p,{children:["Template sections are marked using ",(0,t.jsx)(n.code,{children:"${...}"})," and will be transformed to SQL on execution. The templating expression inside ",(0,t.jsx)(n.code,{children:"${...}"})," consists of a small DSL supporting:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Accessing user attributes using syntax ",(0,t.jsx)(n.code,{children:'user_attribute("attribute_name")'})]}),"\n",(0,t.jsxs)(n.li,{children:["Direct variables, e.g. ",(0,t.jsx)(n.code,{children:"veezoo.Tenant.Id"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Functions with syntax ",(0,t.jsx)(n.code,{children:"function(...)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"quote"})," and ",(0,t.jsx)(n.code,{children:"raw"})," functions are used to convert strings to SQL code"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"string_list"})," is used for lists of strings, mapping them to an expression usable with ",(0,t.jsx)(n.code,{children:"IN"})," in SQL"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"pre-defined-attributes-and-variables",children:"Pre-Defined Attributes and Variables"}),"\n",(0,t.jsxs)(n.p,{children:["The following user attributes can be accessed through the ",(0,t.jsx)(n.code,{children:"user_attribute"})," function, e.g. ",(0,t.jsx)(n.code,{children:'${user_attribute("veezoo.User.Email")}'}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Attribute"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"veezoo.User.First_Name"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"The user's first name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"veezoo.User.Full_Name"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"The user's full name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"veezoo.User.Email"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"The user's email address"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"veezoo.User.Roles"})}),(0,t.jsx)(n.td,{children:"list"}),(0,t.jsxs)(n.td,{children:["The user's assigned roles (use with ",(0,t.jsx)(n.code,{children:"string_list"})," for SQL ",(0,t.jsx)(n.code,{children:"IN"})," clauses)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"veezoo.User.Is_Technical_User"})}),(0,t.jsx)(n.td,{children:"boolean"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"true"})," for technical users (sync operations, internal tools), ",(0,t.jsx)(n.code,{children:"false"})," for regular users"]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["In addition, you can access custom user attributes as specified by SAML or JWT. See the ",(0,t.jsx)(n.a,{href:"/veezoo/single-sign-on/user-attributes",children:"User Attributes Reference"})," documentation for a complete list with descriptions."]}),"\n",(0,t.jsxs)(n.p,{children:["The following attributes can be accessed directly, e.g. ",(0,t.jsx)(n.code,{children:"${veezoo.Tenant.Id}"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/veezoo/embedded/embedded-guide#7-define-authorization-logic-for-tenants",children:"veezoo.Tenant.Id"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"row-level-authorization",children:"Row-Level Authorization"}),"\n",(0,t.jsxs)(n.p,{children:["To implement row-level authorization, you can transform a table into a ",(0,t.jsx)(n.a,{href:"/vkl/db-layer/virtual-table",children:"virtual_table"})," and include user-specific SQL templates."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import: [\n    db.postgres.orders_db.public.ORDERS\n]\n\ndb.orders_db.public {\n    virtual_table orders {\n        identifier: "orders"\n\n        virtual_table_sql:\n         """\n            SELECT\n                o.*\n            FROM\n                "orders_db"."public"."orders" o\n            WHERE\n                o."customer_email" = ${quote(user_attribute("veezoo.User.Email"))}\n         """\n\n        ...\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In the example above, the ",(0,t.jsx)(n.code,{children:"virtual_table_sql"})," will only return the rows of the ",(0,t.jsx)(n.code,{children:"orders"})," table where the ",(0,t.jsx)(n.code,{children:"customer_email"})," matches the logged-in user's email."]}),"\n",(0,t.jsxs)(n.p,{children:["As another example in the case of ",(0,t.jsx)(n.a,{href:"/veezoo/embedded/embedded-guide",children:"Multi-Tenant Self-Service Analytics"}),", we can restrict the data based on the tenant ID."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'db.storage.hiring_app {\n\n    virtual_table candidates {\n\n        identifier: "candidates"\n\n        # Only show candidates from the current tenant\n        virtual_table_sql:\n         """\n            SELECT\n              *\n            FROM\n              candidates c\n            WHERE\n              c.company_id = ${quote(veezoo.Tenant.Id)}\n            """\n\n\n        column ID {\n            identifier: "ID"\n            is_primary_key: true\n            primitive_type: "varchar"\n        }\n\n        ...\n   }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"bypassing-row-level-security-for-technical-users",children:"Bypassing Row-Level Security for Technical Users"}),"\n",(0,t.jsx)(n.p,{children:"When using row-level authorization, you will want to allow the technical user (used for syncing entities) to bypass the security filter.\nOtherwise, some entities may be filtered out by the row-level restrictions when you sync them from the database."}),"\n",(0,t.jsxs)(n.p,{children:["You can achieve this by using the ",(0,t.jsx)(n.code,{children:"veezoo.User.Is_Technical_User"})," attribute, which returns ",(0,t.jsx)(n.code,{children:"true"})," for technical users and ",(0,t.jsx)(n.code,{children:"false"})," for regular users:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'db.orders_db.public {\n    virtual_table orders {\n        identifier: "orders"\n\n        virtual_table_sql:\n         """\n            SELECT\n                o.*\n            FROM\n                "orders_db"."public"."orders" o\n            WHERE\n                ${user_attribute("veezoo.User.Is_Technical_User")}\n                OR o."customer_email" = ${quote(user_attribute("veezoo.User.Email"))}\n         """\n\n        ...\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this example, technical users will see all rows (since ",(0,t.jsx)(n.code,{children:"Is_Technical_User"})," evaluates to ",(0,t.jsx)(n.code,{children:"true"}),"), while regular users will only see rows where their email matches the ",(0,t.jsx)(n.code,{children:"customer_email"})," column."]}),"\n",(0,t.jsx)(n.p,{children:"By using row-level authorization, you can enhance your data security and maintain a high degree of data access control within Veezoo. Remember to always review your SQL templates to ensure that they are accurate and efficient."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);